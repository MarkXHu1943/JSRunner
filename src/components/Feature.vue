<template>
  <div class="feature">
    <a-drawer
      width="80%"
      :visible="visible"
      ok-text="保存"
      @open="handleDrawerOpen"
      @close="handleDrawerClose"
      @ok="handleOk"
      @cancel="handleCancel"
    >
      <template #title> 快捷脚本 </template>
      <div class="title">
        <img class="logo" :src="store.logo" @click="handleLogoClick" alt="logo" draggable="false" />
        <div class="input-field">
          <a-input
            class="name"
            ref="inputRef"
            v-model="store.name"
            :max-length="50"
            placeholder="请输入脚本名称"
            allow-clear
            show-word-limit
          />
          <a-textarea
            class="description"
            v-model="store.description"
            :max-length="100"
            placeholder="请输入脚本描述"
            auto-size
            allow-clear
            show-word-limit
          />
        </div>
      </div>
      <a-divider />
      <FeatureForm v-model="store.features"></FeatureForm>
    </a-drawer>
  </div>
</template>

<script setup lang="ts">
import type { Input } from '@arco-design/web-vue'
import { useFeatureStore } from '@/store'

defineProps<{
  visible: boolean
}>()

const emit = defineEmits(['open', 'close', 'save'])
const inputRef = ref<InstanceType<typeof Input>>()

const store = useFeatureStore()

function handleDrawerKeydown(ev: KeyboardEvent) {
  if (ev.key === 'Escape') {
    emit('close')
    ev.stopPropagation()
  }
}

function handleDrawerOpen() {
  inputRef.value?.focus() // focus input, ESC will close drawer
  document.addEventListener('keydown', handleDrawerKeydown)
}

function handleDrawerClose() {
  document.removeEventListener('keydown', handleDrawerKeydown)
}

function handleOk() {
  emit('save')
  emit('close')
}

function handleCancel() {
  emit('close')
}

function handleLogoClick() {
  console.log('logo click')
}
</script>

<style lang="less" scoped>
.title {
  display: flex;
  align-items: flex-start;
}
.logo {
  height: 100px;
  cursor: pointer;
  transition: box-shadow 0.2s ease-out;
  &:hover {
    box-shadow: 0 0 5px 2px var(--color-text-4);
  }
}
.input-field {
  margin-left: 10px;
  width: 100%;
}
.description {
  margin-top: 10px;
  height: 59px;
}
</style>
